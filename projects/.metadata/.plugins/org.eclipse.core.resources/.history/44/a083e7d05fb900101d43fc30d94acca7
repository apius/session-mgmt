package org.apius.server.identity.session.server.openam;

import java.io.IOException;

import org.apius.messaging.atom.AtomMessageBuilder;
import org.restlet.data.MediaType;
import org.restlet.ext.atom.Content;
import org.restlet.ext.atom.Entry;
import org.restlet.ext.atom.Link;
import org.restlet.ext.atom.Relation;
import org.restlet.ext.xml.DomRepresentation;
import org.restlet.ext.xml.SaxRepresentation;

final class ResponseBuilder {

    private AtomMessageBuilder atomMessageBuilder;
    
    ResponseBuilder(AtomMessageBuilder atomMessageBuilder) {
        this.atomMessageBuilder = atomMessageBuilder;
    }
    
    SaxRepresentation writeCreateSessionXml(String token) throws IOException {
        Entry entry = atomMessageBuilder.createEntry();
        Link link = 
            atomMessageBuilder.createLink("openam-session-attributes", "/identity/session/attributes", Relation.RELATED);
        entry.setTitle(atomMessageBuilder.createText("openam-session"));
        entry.setId(token);
        entry.getLinks().add(link);
        
        return entry;
    }
    
    SaxRepresentation writeSessionAttributesXml(DomRepresentation attributesAsXml) throws IOException {
        attributesAsXml.getDocument().setXmlStandalone(true);
        
        Content content = atomMessageBuilder.createContent(MediaType.APPLICATION_XML, attributesAsXml);
        content.setToEncode(false);
        
        Entry entry = atomMessageBuilder.createEntry();
        entry.setTitle(atomMessageBuilder.createText("openam-session-attributes"));
        entry.setContent(content);
        
        return entry;
    }
}
